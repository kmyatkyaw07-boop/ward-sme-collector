<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SME Data Collector Myanmar</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pyidaungsu:wght@400;700&display=swap');
body { font-family:'Inter','Pyidaungsu',sans-serif; }
#map { height:220px; }
.chip{border:1px solid #e2e8f0;padding:8px 14px;border-radius:999px;font-size:12px;font-weight:600}
.chip.active{background:#3730a3;color:#fff;border-color:#3730a3}
.hidden{display:none}
</style>
</head>

<body class="bg-slate-50 pb-10">

<header class="bg-indigo-900 text-white p-4 sticky top-0 z-50 flex justify-between items-center">
  <h1 class="font-bold text-sm flex gap-2 items-center">
    <i data-lucide="database"></i> SME COLLECTOR
    <span class="text-[10px] bg-amber-400 px-1 rounded text-indigo-900">MM</span>
  </h1>
  <select id="lang" class="bg-indigo-800 text-xs px-2 py-1 rounded">
    <option value="mm" selected>မြန်မာ</option>
    <option value="en">English</option>
  </select>
</header>

<main class="max-w-md mx-auto p-4 space-y-4">

<!-- MAP -->
<section class="bg-white rounded-2xl shadow overflow-hidden">
  <div id="map"></div>
  <div class="flex justify-between p-2 text-xs">
    <span id="coords">0.000000, 0.000000</span>
    <button onclick="getGPS()" class="text-indigo-700 font-bold" data-t="gps">တည်နေရာယူမည်</button>
  </div>
</section>

<form id="form" class="space-y-4">

<input type="hidden" name="lat" id="lat">
<input type="hidden" name="lng" id="lng">
<input type="hidden" name="lang_used" id="lang_used" value="mm">

<!-- COLLECTOR -->
<section class="bg-white p-4 rounded-2xl space-y-2">
  <label class="text-xs font-bold text-slate-500" data-t="collector">Enumerator / Collector ID</label>
  <input required name="collector_id" class="w-full p-3 rounded-xl border bg-slate-50 text-sm"
   placeholder="MM-YGN-01">
</section>

<!-- BUSINESS -->
<section class="bg-white p-4 rounded-2xl space-y-3">
<h3 class="font-bold text-xs text-indigo-900" data-t="biz">လုပ်ငန်းအချက်အလက်</h3>

<input required name="shop_name" class="w-full p-3 rounded-xl border bg-slate-50 text-sm"
 placeholder="ဆိုင်အမည် / Shop Name">

<select id="mainCat" name="category_main"
 class="w-full p-3 rounded-xl border bg-slate-50 text-sm"></select>

<select id="subCat" name="category_sub"
 class="w-full p-3 rounded-xl border bg-slate-50 text-sm"></select>

<input id="otherCat" name="other_category"
 class="w-full p-3 rounded-xl border bg-indigo-50 text-sm hidden"
 placeholder="အခြားအမျိုးအစား ဖော်ပြပါ">

<select name="years_active"
 class="w-full p-3 rounded-xl border bg-slate-50 text-sm">
  <option value="<1">၁ နှစ်အောက်</option>
  <option value="1-3">၁ – ၃ နှစ်</option>
  <option value="3-5">၃ – ၅ နှစ်</option>
  <option value="5+">၅ နှစ်အထက်</option>
</select>
</section>

<!-- PAYMENT -->
<section class="bg-white p-4 rounded-2xl space-y-2">
<h3 class="font-bold text-xs text-indigo-900" data-t="pay">ငွေပေးချေမှု</h3>
<div id="pay" class="flex flex-wrap gap-2"></div>
<input type="hidden" name="digital_pay" id="payVal">
</section>

<!-- DELIVERY -->
<section class="bg-white p-4 rounded-2xl space-y-2">
<h3 class="font-bold text-xs text-indigo-900" data-t="del">ပို့ဆောင်ရေး</h3>
<div id="delivery" class="flex flex-wrap gap-2"></div>
<input type="hidden" name="delivery_apps" id="delVal">
</section>

<button type="button" onclick="submitData()"
 class="w-full bg-indigo-900 text-white py-4 rounded-2xl font-bold"
 data-t="save">သိမ်းဆည်းမည်</button>

</form>
</main>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const API_URL="YOUR_APPS_SCRIPT_URL";

const dict={
mm:{
 gps:"တည်နေရာယူမည်",
 collector:"စာရင်းကောက်ယူသူ",
 biz:"လုပ်ငန်းအချက်အလက်",
 pay:"ငွေပေးချေမှု",
 del:"ပို့ဆောင်ရေး",
 save:"သိမ်းဆည်းမည်",
 payments:["လက်ငင်းသီးသန့်","MMQR","KPay","WaveMoney","AYA Pay","TrueMoney"],
 deliveries:["မရှိပါ","FoodPanda","Grab","Door2Door","ကိုယ်ပိုင်ပို့"]
},
en:{
 gps:"Get GPS",
 collector:"Collector ID",
 biz:"Business Info",
 pay:"Payment",
 del:"Delivery",
 save:"Save Data",
 payments:["Cash Only","MMQR","KPay","WaveMoney","AYA Pay","TrueMoney"],
 deliveries:["None","FoodPanda","Grab","Door2Door","Own Delivery"]
}
};

const categories={
mm:{
"စားသောက်ကုန်":["စားသောက်ဆိုင်","လက်ဖက်ရည်ဆိုင်","လမ်းဘေး","မုန့်တိုက်","ဘား/KTV","အခြား"],
"အရောင်းဆိုင်":["ကုန်စုံ","မီနီမတ်","အဝတ်အထည်","ဖုန်းဆိုင်","ဆေးဆိုင်","အခြား"],
"ဝန်ဆောင်မှု":["ဆံပင်ညပ်","အဝတ်လျှော်","ပြင်ဆင်ရေး","မိတ္တူ","အပ်ချုပ်","ဆေးခန်း","အခြား"],
"ရွှေ/ငွေကြေး":["ရွှေဆိုင်","ပန်းထိမ်","မိုဘိုင်းငွေ","ငွေလဲ","အခြား"],
"ဆောက်လုပ်ရေး":["ဟာ့ဒ်ဝဲ","ဆေးသုတ်","လျှပ်စစ်","ရေသွယ်","အခြား"]
},
en:{
"Food & Beverage":["Restaurant","Tea Shop","Street Food","Bakery","Bar/KTV","Other"],
"Retail":["Grocery","Mini Mart","Clothing","Phone Shop","Pharmacy","Other"],
"Services":["Salon","Laundry","Repair","Printing","Tailor","Clinic","Other"],
"Finance & Gold":["Gold Shop","Goldsmith","Mobile Money","Exchange","Other"],
"Construction":["Hardware","Paint","Electrical","Plumbing","Other"]
}
};

let lang="mm",paySet=new Set(),delSet=new Set();

function updateLang(){
lang=document.getElementById('lang').value;
lang_used.value=lang;
document.querySelectorAll('[data-t]').forEach(e=>e.innerText=dict[lang][e.dataset.t]);
initCats(); renderChips();
}

function initCats(){
mainCat.innerHTML=Object.keys(categories[lang]).map(c=>`<option>${c}</option>`).join('');
updateSub();
}

function updateSub(){
subCat.innerHTML=categories[lang][mainCat.value].map(s=>`<option>${s}</option>`).join('');
toggleOther();
}

function toggleOther(){
otherCat.classList.toggle('hidden',subCat.value!=="Other"&&subCat.value!=="အခြား");
}

function renderChips(){
chips('pay',dict[lang].payments,paySet,'payVal');
chips('delivery',dict[lang].deliveries,delSet,'delVal');
}

function chips(id,list,set,hidden){
document.getElementById(id).innerHTML=list.map(v=>
`<div class="chip ${set.has(v)?'active':''}"
 onclick="set.has('${v}')?set.delete('${v}'):set.add('${v}');
 document.getElementById('${hidden}').value=[...set].join(',');
 this.classList.toggle('active')">${v}</div>`).join('');
}

function getGPS(){
navigator.geolocation.getCurrentPosition(p=>{
lat.value=p.coords.latitude.toFixed(6);
lng.value=p.coords.longitude.toFixed(6);
coords.innerText=`${lat.value}, ${lng.value}`;
marker.setLatLng([lat.value,lng.value]); map.setView([lat.value,lng.value],17);
},()=>alert("GPS unavailable"));
}

async function submitData(){
if((subCat.value==="Other"||subCat.value==="အခြား")&&!otherCat.value){
alert("Please specify other category"); return;
}
const data=Object.fromEntries(new FormData(form));
data.timestamp=new Date().toISOString();
await fetch(API_URL+"?"+new URLSearchParams(data),{mode:'no-cors'});
alert(lang==="mm"?"သိမ်းဆည်းပြီးပါပြီ":"Saved successfully");
form.reset();paySet.clear();delSet.clear();renderChips();
}

const map=L.map('map').setView([16.84,96.17],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
const marker=L.marker([16.84,96.17],{draggable:true}).addTo(map);
marker.on('dragend',()=>{const p=marker.getLatLng();lat.value=p.lat;lng.value=p.lng;coords.innerText=`${p.lat},${p.lng}`});

lang.onchange=updateLang;
mainCat.onchange=updateSub;
subCat.onchange=toggleOther;

updateLang();
lucide.createIcons();
</script>
</body>
</html>
